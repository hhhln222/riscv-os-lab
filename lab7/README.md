# ä»é›¶æ„å»ºæ“ä½œç³»ç»Ÿ - å­¦ç”Ÿå®éªŒæäº¤

**å®Œæˆé˜¶æ®µ**ï¼šå®éªŒ7 - æ–‡ä»¶ç³»ç»Ÿ (å…¨éƒ¨å®éªŒå®Œæˆ)

## ğŸ“Œ é¡¹ç›®ç®€ä»‹

æœ¬é¡¹ç›®æ˜¯ä¸€ä¸ªåŸºäº RISC-V æ¶æ„ä»é›¶å¼€å§‹æ„å»ºçš„æ•™å­¦ç”¨æ“ä½œç³»ç»Ÿã€‚åœ¨å®éªŒ7ä¸­ï¼Œæˆ‘ä»¬åœ¨å‰å…­ä¸ªå®éªŒçš„åŸºç¡€ä¸Šï¼Œå®ç°äº†ä¸€ä¸ªå®Œæ•´çš„**ç±» Unix æ–‡ä»¶ç³»ç»Ÿ**ã€‚ç³»ç»Ÿé‡‡ç”¨äº†ç»å…¸çš„ **Inode-Based** è®¾è®¡ï¼ŒåŒ…å«å—ç¼“å­˜å±‚ã€æ—¥å¿—å±‚ï¼ˆç®€åŒ–ç‰ˆï¼‰ã€Inode å±‚å’Œç›®å½•å±‚ã€‚

âœ… **åº•å±‚é©±åŠ¨**ï¼šå®ç°äº†åŸºäºå†…å­˜çš„ RAM Disk é©±åŠ¨ï¼Œæ¨¡æ‹Ÿå—è®¾å¤‡è¯»å†™ã€‚
âœ… **ç¼“å†²å±‚ (Buffer Cache)**ï¼šå®ç°äº† LRU ç­–ç•¥çš„å—ç¼“å­˜ï¼Œå‡å°‘ç£ç›˜ I/Oã€‚
âœ… **æ–‡ä»¶ç³»ç»Ÿæ ¸å¿ƒ**ï¼šå®ç°äº† Superblock è§£æã€Inode åˆ†é… (`iget`/`iput`) å’Œæ•°æ®å—æ˜ å°„ (`bmap`)ã€‚
âœ… **æ–‡ä»¶æ“ä½œ**ï¼šå®ç°äº†åŸºç¡€çš„ `readi` å’Œ `writei`ï¼Œæ”¯æŒæ•°æ®çš„æŒä¹…åŒ–å­˜å‚¨ä¸è¯»å–ã€‚

## ğŸ¯ å®éªŒç›®æ ‡

1. ç†è§£æ–‡ä»¶ç³»ç»Ÿçš„åˆ†å±‚æ¶æ„ï¼ˆInterface -> FS -> Cache -> Deviceï¼‰ã€‚
2. æŒæ¡ç£ç›˜å…ƒæ•°æ®ï¼ˆSuperblock, Inode, Bitmapï¼‰çš„ç®¡ç†æ–¹å¼ã€‚
3. å®ç°å—ç¼“å­˜ï¼ˆBuffer Cacheï¼‰çš„åŒæ­¥ä¸æ›¿æ¢ç®—æ³•ã€‚
4. ç†è§£æ–‡ä»¶æè¿°ç¬¦ä¸åº•å±‚ Inode çš„æ˜ å°„å…³ç³»ã€‚

## ğŸ›  å¼€å‘ç¯å¢ƒ

- **æ“ä½œç³»ç»Ÿ**ï¼šUbuntu 22.04 LTS / WSL2
- **äº¤å‰ç¼–è¯‘å·¥å…·é“¾**ï¼š`riscv64-unknown-elf-gcc`
- **æ¨¡æ‹Ÿå™¨**ï¼š`qemu-system-riscv64`
- **æ„å»ºç³»ç»Ÿ**ï¼šGNU Make

## ğŸš€ ç¼–è¯‘ä¸è¿è¡Œ

### 1. ç¼–è¯‘å†…æ ¸
```bash
make clean
make
```

### 2. åœ¨ QEMU ä¸­è¿è¡Œ
```bash
make qemu
```

**é¢„æœŸè¾“å‡º**ï¼š
```
ramdisk: initialized (1000 blocks).
binit: buffer cache initialized.
ramdisk: filesystem formatted.
fsinit: file system mounted. size=1000 blocks
--- Test: File System ---
[PASS] iget root inode (inum=1)
Root Inode: type=1, nlink=1
[PASS] Root is a directory
Wrote 16 bytes to root inode.
Read back: Hello FS World!
[PASS] Read/Write verification successful!
=== ALL TESTS COMPLETED ===
```

## ğŸ“‚ ç›®å½•ç»“æ„ (å®Œæ•´ç‰ˆ)
```
.
â”œâ”€â”€ kernel/
â”‚   â”œâ”€â”€ ramdisk.c            # [æ–°å¢] æ¨¡æ‹Ÿç£ç›˜é©±åŠ¨
â”‚   â”œâ”€â”€ bio.c                # [æ–°å¢] Buffer Cache (LRU)
â”‚   â”œâ”€â”€ fs.c                 # [æ–°å¢] æ–‡ä»¶ç³»ç»Ÿæ ¸å¿ƒ (Inode, Bmap)
â”‚   â”œâ”€â”€ file.c               # [æ–°å¢] æ–‡ä»¶æè¿°ç¬¦å±‚
â”‚   â”œâ”€â”€ sysfile.c            # [æ–°å¢] æ–‡ä»¶ç³»ç»Ÿè°ƒç”¨æ¥å£
â”‚   â”œâ”€â”€ syscall.c            # ç³»ç»Ÿè°ƒç”¨åˆ†å‘
â”‚   â”œâ”€â”€ proc.c               # è¿›ç¨‹è°ƒåº¦
â”‚   â”œâ”€â”€ trap.c               # ä¸­æ–­å¤„ç†
â”‚   â”œâ”€â”€ vmm.c                # è™šæ‹Ÿå†…å­˜
â”‚   â”œâ”€â”€ pmm.c                # ç‰©ç†å†…å­˜
â”‚   â””â”€â”€ start.c              # å†…æ ¸å…¥å£
â”œâ”€â”€ include/
â”‚   â”œâ”€â”€ fs.h                 # [æ–°å¢] ç£ç›˜å¸ƒå±€ç»“æ„ (Superblock, Dinode)
â”‚   â”œâ”€â”€ buf.h                # [æ–°å¢] ç¼“å­˜å—å¤´å®šä¹‰
â”‚   â”œâ”€â”€ file.h               # [æ–°å¢] å†…å­˜æ–‡ä»¶ç»“æ„
â”‚   â”œâ”€â”€ stat.h               # [æ–°å¢] æ–‡ä»¶çŠ¶æ€ç»“æ„
â”‚   â”œâ”€â”€ fcntl.h              # [æ–°å¢] æ–‡ä»¶æ§åˆ¶å®
â”‚   â””â”€â”€ param.h              # [æ–°å¢] ç³»ç»Ÿå‚æ•°å®šä¹‰
```

## âœ¨ åŠŸèƒ½è¿›åº¦

- [x] å®éªŒ1ï¼šè£¸æœºå¯åŠ¨ä¸UARTå­—ç¬¦è¾“å‡º
- [x] å®éªŒ2ï¼šå†…æ ¸printfä¸æ§åˆ¶å°æ‰©å±•
- [x] å®éªŒ3ï¼šç‰©ç†å†…å­˜ç®¡ç†ä¸é¡µè¡¨ç³»ç»Ÿ
- [x] å®éªŒ4ï¼šä¸­æ–­ä¸å¼‚å¸¸å¤„ç†
- [x] å®éªŒ5ï¼šè¿›ç¨‹ä¸ä¸Šä¸‹æ–‡åˆ‡æ¢
- [x] å®éªŒ6ï¼šç³»ç»Ÿè°ƒç”¨
- [x] å®éªŒ7ï¼šç®€æ˜“æ–‡ä»¶ç³»ç»Ÿ

